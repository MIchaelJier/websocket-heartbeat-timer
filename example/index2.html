<!DOCTYPE html>
<html>

<head>
    <title>websocket-heartbeat-js demo</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<style>
    .logs {
        padding: 40px 0 0 40px;
    }

    .logs div {
        line-height: 26px;
        font-size: 16px;
    }

    .brown {
        color: brown;
        font-size: 14px!important;
    }
    .cadetblue{
        color: cadetblue;
    }
    .chocolate{
        color: chocolate;
    }
    .gray {
        color: #666666;
    }
</style>

<body>
    <div style="position: fixed;"> 
        <button onclick="connect()">connect</button>
        <button onclick="connect(true)">user2 connect</button> 
        <button onclick="start()">start</button>
        <button onclick="stop()">stop</button>
        <button onclick="closeConnect()">close connect</button>
    </div>
    <div class="logs" id="logs"></div>

    <script  src="./../dist/wsHeartbeat.min.js"></script>   
    <!-- type="model" --> 
    <script>
        const $logs = document.getElementById('logs');
        function addLog(log, color = 'gray') {
            let div = document.createElement('div');
            div.textContent = log;
            div.className = color;
            $logs.appendChild(div);
            window.scrollTo(0, 100000); 
        }
    </script>
    <script> 
        function connect(isNew) {
            isNew && worker.useIt('uuid').useIt('userInfo', {
                  token: '00000', 
                  id: '0000',   
            }) 
            worker.postMessage({ cmd: 'createWebSocket' });     
        }
        function start() { 
            worker.start() 
        }
        function stop() {
            worker.postMessage({ cmd: 'stop' });     
        }
        function closeConnect() { 
            worker.postMessage({ cmd: 'close' });     
        }
        const url = 'ws://localhost:8080/';  
        let firstHeartbeat = true;  
        const worker = websocketHeartbeat({    
            url: url,    
            pingTimeout: 1000, 
            pongTimeout: 1000, 
            repeatLimit: 3, 
            manualStart: true, 
            userInfo: { 
                token: '1234567',
                id: '1234',
            }  
        }).useIt('uuid') 
        console.log(worker)
        // worker.postMessage({ cmd: 'onopen', msg: function() {
        //     console.log('connect success') 
        // } });   
        worker.onOpen = function () {
            addLog('connect success', 'cadetblue');
            addLog('send massage: test', 'cadetblue');
            setTimeout(() => {
                // addLog(`wait ${worker.opts.pingTimeout} ms will hava a '${worker.opts.pingMsg}' messages`, 'cadetblue');
            }, 1500);
        }
        worker.onMessage = function (e) {
            addLog(`onmessage: ${e.data}`);
            if (e.data == worker.opts.pingMsg && firstHeartbeat) {
                setTimeout(() => {
                    addLog(`Close your network, wait ${worker.opts.pingTimeout + worker.opts.pongTimeout}+ ms, websocket will reconnect`, 'cadetblue');
                }, 1500);
                firstHeartbeat = false;
            }
        }
        worker.onReconnect = function () {
            addLog(`reconnecting...`, 'brown');
            addLog(`network closing`, 'brown');
        } 
        worker.onClose = function () {
            addLog(`onclose`, 'brown'); 
        }
        worker.onStart = function () {
            addLog(`onstart`, 'brown'); 
        }
        worker.onStop = function () {
            addLog(`onstop`, 'brown'); 
        }
    </script>
</body>

</html>